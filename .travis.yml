language: python
matrix:
  include:
  - name: linux_py3
    python: 3.6
    os: linux
    before_install:
    - pip install -r requirements.txt

  - name: linux_py2
    python: 2.7
    os: linux
    before_install:
    - pip install -r requirements.txt

  - os: macosx_py2
    osx_image: xcode11.2
    language: shell
    before_install:
    - pip install -r requirements.txt

  - name: win_py3
    os: windows
    language: shell
    before_install:
    - choco install python --version 3.8.1 --no-progress
    - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
    - cp /c/Python38/python.exe /c/Python38/python3.exe
    - pip install -r requirements.txt
    - pip install wheel

  - name: win_py2
    os: windows
    language: shell
    before_install:
    - choco install python2 --no-progress
    - choco install --ignore-dependencies vcpython27
    - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
    - pip install -r requirements.txt
    - pip install wheel

install:
- python setup.py build_ext --inplace
- python setup.py sdist bdist_wheel

script:
- export PYTHONPATH=$TRAVIS_BUILD_DIR
- python tests/test.py
- set

deploy:
  provider: releases
  name: $TRAVIS_BRANCH.$TRAVIS_COMMIT.$TRAVIS_JOB_NAME
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: dist/*
  overwrite: true
  skip_cleanup: true
  draft: true
  prerelease: true
  on:
    repo: fastlmm/PySnpTools
    all_branches: true

#deploy:
#  provider: releases
#  api_key:
#    secure: 
#  file: dist/*
#  overwrite: true
#  skip_cleanup: true
#  draft: true
#  prerelease: true
#  on:
#    repo: fastlmm/PySnpTools
#    all_branches: true


#deploy:
#  provider: script
# #script: bash -c "ls -las dist"
#  script: bash -c "echo $NOT_NEEDED"
#  skip_cleanup: true
#  on:
#    branch: dev

notifications:
  email:
    recipients:
    - carlk@msn.com
    on_success: always
    on_failure: always
