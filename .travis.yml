language: python
matrix:
  include:
  - name: linux 3
    python: 3.6
    os: linux
    before_install:
    - pip install -r requirements.txt

  - name: linux 2
    python: 2.7
    os: linux
    before_install:
    - pip install -r requirements.txt

  - os: osx
    osx_image: xcode11.2
    language: shell
    before_install:
    - pip install -r requirements.txt

  - name: Windows 3
    os: windows
    language: shell
    before_install:
    - choco install python --version 3.8.1 --no-progress
    - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
    - cp /c/Python38/python.exe /c/Python38/python3.exe
    - pip install -r requirements.txt
    - pip install wheel

  - name: Windows 2
    os: windows
    language: shell
    before_install:
    - choco install python2 --no-progress
    - choco install --ignore-dependencies vcpython27
    - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
    - pip install -r requirements.txt
    - pip install wheel

install:
- python setup.py build_ext --inplace
- python setup.py sdist bdist_wheel

script:
- export PYTHONPATH=$TRAVIS_BUILD_DIR
- python tests/test.py

deploy:
  provider: releases
  api_key:
    secure: IUObYmt2/MGFzjXeLkN89I1w56tuSOPrwVs3YYHxDgOaM/rtWV7sNwxay8oXxhSVILb5P7P6H34WBfg9ma34YefBUJnfDAD9J476CDuGMrKJrYlr637dewEV4HkJKJnLTwdgXEcdY+OLCXj+DKe5LkTVputOgIwO+01HQxd/4M4XBXGIgxBShcekmPnEFhi4pTDxxgV6y6sI3R58DeKJLQTIDh9E7Ej8WbncU/ixtz0ttq7rtPb4AZN2VvKmtCLTjKzkMVXNks3rGbRHWPkMviDNnh745sQ8rvVew0IMqZxcZfDL43Kh8g2zekiBdwPUHTIHnyNtyIE9Nyv/wpBovuLuxla2KJQyYah+1rEPa8FHWPnMY9dJlu6XAL/dQxOM7v5lino+rzhn82JDTtHgLDBrYZmZu1TEpNKOBIPCVNvF9I/XR/rSSVtRtlUv5v97tPBhA4zRe1UabaW17G9lZgoo9oNyUUfD2MWD1P074Hv2Udij0I0oKf+MQI55JbYAn0AF2uGjxSl6sLDc1BpfN2WLMHnKY/d3fSopdY03EvQjN6d/hoKLxtyi6A05ij4CqsuIwEPSHdUQwawz3JToaZU9cnSaK5Mj17Tu69mbZ7mCZ31zgR5MnaPcUInFPRKEO4IevH9ycYDKlGiD4kW9qsxzJPEEDv4L09MXrb77/4Q=
  file: dist/*
  overwrite: true
  skip_cleanup: true
  draft: true
  prerelease: true
  on:
    repo: fastlmm/PySnpTools
    all_branches: true


#deploy:
#  provider: script
# #script: bash -c "ls -las dist"
#  script: bash -c "echo $NOT_NEEDED"
#  skip_cleanup: true
#  on:
#    branch: dev

notifications:
  email:
    recipients:
    - carlk@msn.com
    on_success: always
    on_failure: always
